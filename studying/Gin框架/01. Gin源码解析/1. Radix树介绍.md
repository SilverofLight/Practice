gin框架使用的是定制版本的httprouter，路由原理大量使用公共前缀的树结构，它基本上是一个紧凑的Trie tree。具有公共前缀的节点也共享一个公共父节点。

# Radix树

基数数（Radix Tree）又称 PAT 树（Patricia Trie or crit bit tree），是一种更节省空间的前缀树（Trie Tree）。对于基数树的每个节点，如果该节点是唯一的子树的话，就和父节点合并，示例：
![[Pasted image 20240321193208.png]]

虽然没哟哈希快，但是也足够快，不会影响性能

Radix Tree 可以被认为十一颗简洁版的前缀树，我们注册路由的过程就是构造前缀树的过程，具有公共前缀的节点也共享一个公共父节点。假设我们现在注册有以下的路由信息：
~~~go
r := gin.Default()
r.GET("/", func1)
r.GET("/search/", func2)
r.GET("/support/", func3)
r.GET("/blog/", func4)
r.GET("/blog/:post/", func5)
r.GET("/about-us/", func6)
r.GET("/about-us/team/", func7)
r.GET("/contact/", func8)
~~~
我们会得到一个 GET 方法对应的路由树：

![[Pasted image 20240321195146.png]]

最右列的数字表示Handle 处理函数的内存地址，从根节点遍历到叶子节点我们能得到完整的路由表

此外，每一种方法都会有一个单独的树，可以更节省空间，还能快速查找路由问题。

每个树级别上的节点都按 Priority（优先级） 排序，其中优先级就是子节点中注册的句柄的数量。好处：

- 首先优先匹配被大多数路径包含的节点。可以尽可能多的路由快速被定为
- 类似于成本补偿，最长的路径可以被优先匹配，补偿体现在最长的路径需要花费更长的时间来定位，如果最长路径的节点能被优先匹配（即每次拿子节点都命中），那么路由匹配所花的世界不一定比短路径的路由长。


